--- iptables/pre-apply/networking-lab/networking-lab_pre-apply.iptables	2025-05-20 14:02:35.832263014 +0100
+++ iptables/post-apply/networking-lab/networking-lab_post-apply.iptables	2025-05-20 14:04:58.899690810 +0100
@@ -1,4 +1,4 @@
-# Generated by iptables-save v1.8.10 (nf_tables) on Tue May 20 13:02:14 2025
+# Generated by iptables-save v1.8.10 (nf_tables) on Tue May 20 13:04:30 2025
 *mangle
 :PREROUTING ACCEPT [0:0]
 :INPUT ACCEPT [0:0]
@@ -9,8 +9,8 @@
 :KUBE-KUBELET-CANARY - [0:0]
 :KUBE-PROXY-CANARY - [0:0]
 COMMIT
-# Completed on Tue May 20 13:02:14 2025
-# Generated by iptables-save v1.8.10 (nf_tables) on Tue May 20 13:02:14 2025
+# Completed on Tue May 20 13:04:30 2025
+# Generated by iptables-save v1.8.10 (nf_tables) on Tue May 20 13:04:30 2025
 *filter
 :INPUT ACCEPT [0:0]
 :FORWARD ACCEPT [0:0]
@@ -54,22 +54,24 @@
 -A KUBE-FORWARD -m comment --comment "kubernetes forwarding rules" -m mark --mark 0x4000/0x4000 -j ACCEPT
 -A KUBE-FORWARD -m comment --comment "kubernetes forwarding conntrack rule" -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
 COMMIT
-# Completed on Tue May 20 13:02:14 2025
-# Generated by iptables-save v1.8.10 (nf_tables) on Tue May 20 13:02:14 2025
+# Completed on Tue May 20 13:04:30 2025
+# Generated by iptables-save v1.8.10 (nf_tables) on Tue May 20 13:04:30 2025
 *nat
-:PREROUTING ACCEPT [63:4577]
-:INPUT ACCEPT [53:3205]
-:OUTPUT ACCEPT [566:33940]
-:POSTROUTING ACCEPT [593:36190]
+:PREROUTING ACCEPT [69:4950]
+:INPUT ACCEPT [58:3505]
+:OUTPUT ACCEPT [1059:63520]
+:POSTROUTING ACCEPT [1086:65770]
 :DOCKER - [0:0]
 :DOCKER_OUTPUT - [0:0]
 :DOCKER_POSTROUTING - [0:0]
 :KIND-MASQ-AGENT - [0:0]
+:KUBE-EXT-VSAWDMSKNMGTSBJ2 - [0:0]
 :KUBE-KUBELET-CANARY - [0:0]
 :KUBE-MARK-MASQ - [0:0]
 :KUBE-NODEPORTS - [0:0]
 :KUBE-POSTROUTING - [0:0]
 :KUBE-PROXY-CANARY - [0:0]
+:KUBE-SEP-GR4AD662XYN6ALE6 - [0:0]
 :KUBE-SEP-IT2ZTR26TO4XFPTO - [0:0]
 :KUBE-SEP-N4G2XR5TDX7PQE7P - [0:0]
 :KUBE-SEP-VPILYQBSPPXYB66K - [0:0]
@@ -79,6 +81,7 @@
 :KUBE-SVC-JD5MR3NA4I4DYORP - [0:0]
 :KUBE-SVC-NPX46M4PTMTKRN6Y - [0:0]
 :KUBE-SVC-TCOU7JCQXEZGVUNU - [0:0]
+:KUBE-SVC-VSAWDMSKNMGTSBJ2 - [0:0]
 -A PREROUTING -m comment --comment "kubernetes service portals" -j KUBE-SERVICES
 -A PREROUTING -d 192.168.49.1/32 -j DOCKER_OUTPUT
 -A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER
@@ -96,10 +99,16 @@
 -A DOCKER_POSTROUTING -s 127.0.0.11/32 -p udp -j SNAT --to-source 192.168.49.1:53
 -A KIND-MASQ-AGENT -d 10.244.0.0/16 -m comment --comment "kind-masq-agent: local traffic is not subject to MASQUERADE" -j RETURN
 -A KIND-MASQ-AGENT -m comment --comment "kind-masq-agent: outbound traffic is subject to MASQUERADE (must be last in chain)" -j MASQUERADE
+-A KUBE-EXT-VSAWDMSKNMGTSBJ2 -m comment --comment "masquerade traffic for default/loadbalancer-svc external destinations" -j KUBE-MARK-MASQ
+-A KUBE-EXT-VSAWDMSKNMGTSBJ2 -j KUBE-SVC-VSAWDMSKNMGTSBJ2
 -A KUBE-MARK-MASQ -j MARK --set-xmark 0x4000/0x4000
+-A KUBE-NODEPORTS -d 127.0.0.0/8 -p tcp -m comment --comment "default/loadbalancer-svc" -m tcp --dport 30000 -m nfacct --nfacct-name  localhost_nps_accepted_pkts -j KUBE-EXT-VSAWDMSKNMGTSBJ2
+-A KUBE-NODEPORTS -p tcp -m comment --comment "default/loadbalancer-svc" -m tcp --dport 30000 -j KUBE-EXT-VSAWDMSKNMGTSBJ2
 -A KUBE-POSTROUTING -m mark ! --mark 0x4000/0x4000 -j RETURN
 -A KUBE-POSTROUTING -j MARK --set-xmark 0x4000/0x0
 -A KUBE-POSTROUTING -m comment --comment "kubernetes service traffic requiring SNAT" -j MASQUERADE --random-fully
+-A KUBE-SEP-GR4AD662XYN6ALE6 -s 10.244.1.2/32 -m comment --comment "default/loadbalancer-svc" -j KUBE-MARK-MASQ
+-A KUBE-SEP-GR4AD662XYN6ALE6 -p tcp -m comment --comment "default/loadbalancer-svc" -m tcp -j DNAT --to-destination 10.244.1.2:5000
 -A KUBE-SEP-IT2ZTR26TO4XFPTO -s 10.244.0.2/32 -m comment --comment "kube-system/kube-dns:dns-tcp" -j KUBE-MARK-MASQ
 -A KUBE-SEP-IT2ZTR26TO4XFPTO -p tcp -m comment --comment "kube-system/kube-dns:dns-tcp" -m tcp -j DNAT --to-destination 10.244.0.2:53
 -A KUBE-SEP-N4G2XR5TDX7PQE7P -s 10.244.0.2/32 -m comment --comment "kube-system/kube-dns:metrics" -j KUBE-MARK-MASQ
@@ -108,10 +117,11 @@
 -A KUBE-SEP-VPILYQBSPPXYB66K -p tcp -m comment --comment "default/kubernetes:https" -m tcp -j DNAT --to-destination 192.168.49.2:8443
 -A KUBE-SEP-YIL6JZP7A3QYXJU2 -s 10.244.0.2/32 -m comment --comment "kube-system/kube-dns:dns" -j KUBE-MARK-MASQ
 -A KUBE-SEP-YIL6JZP7A3QYXJU2 -p udp -m comment --comment "kube-system/kube-dns:dns" -m udp -j DNAT --to-destination 10.244.0.2:53
--A KUBE-SERVICES -d 10.96.0.1/32 -p tcp -m comment --comment "default/kubernetes:https cluster IP" -m tcp --dport 443 -j KUBE-SVC-NPX46M4PTMTKRN6Y
--A KUBE-SERVICES -d 10.96.0.10/32 -p udp -m comment --comment "kube-system/kube-dns:dns cluster IP" -m udp --dport 53 -j KUBE-SVC-TCOU7JCQXEZGVUNU
 -A KUBE-SERVICES -d 10.96.0.10/32 -p tcp -m comment --comment "kube-system/kube-dns:dns-tcp cluster IP" -m tcp --dport 53 -j KUBE-SVC-ERIFXISQEP7F7OF4
 -A KUBE-SERVICES -d 10.96.0.10/32 -p tcp -m comment --comment "kube-system/kube-dns:metrics cluster IP" -m tcp --dport 9153 -j KUBE-SVC-JD5MR3NA4I4DYORP
+-A KUBE-SERVICES -d 10.96.36.140/32 -p tcp -m comment --comment "default/loadbalancer-svc cluster IP" -m tcp --dport 80 -j KUBE-SVC-VSAWDMSKNMGTSBJ2
+-A KUBE-SERVICES -d 10.96.0.1/32 -p tcp -m comment --comment "default/kubernetes:https cluster IP" -m tcp --dport 443 -j KUBE-SVC-NPX46M4PTMTKRN6Y
+-A KUBE-SERVICES -d 10.96.0.10/32 -p udp -m comment --comment "kube-system/kube-dns:dns cluster IP" -m udp --dport 53 -j KUBE-SVC-TCOU7JCQXEZGVUNU
 -A KUBE-SERVICES -m comment --comment "kubernetes service nodeports; NOTE: this must be the last rule in this chain" -m addrtype --dst-type LOCAL -j KUBE-NODEPORTS
 -A KUBE-SVC-ERIFXISQEP7F7OF4 ! -s 10.244.0.0/16 -d 10.96.0.10/32 -p tcp -m comment --comment "kube-system/kube-dns:dns-tcp cluster IP" -m tcp --dport 53 -j KUBE-MARK-MASQ
 -A KUBE-SVC-ERIFXISQEP7F7OF4 -m comment --comment "kube-system/kube-dns:dns-tcp -> 10.244.0.2:53" -j KUBE-SEP-IT2ZTR26TO4XFPTO
@@ -121,5 +131,7 @@
 -A KUBE-SVC-NPX46M4PTMTKRN6Y -m comment --comment "default/kubernetes:https -> 192.168.49.2:8443" -j KUBE-SEP-VPILYQBSPPXYB66K
 -A KUBE-SVC-TCOU7JCQXEZGVUNU ! -s 10.244.0.0/16 -d 10.96.0.10/32 -p udp -m comment --comment "kube-system/kube-dns:dns cluster IP" -m udp --dport 53 -j KUBE-MARK-MASQ
 -A KUBE-SVC-TCOU7JCQXEZGVUNU -m comment --comment "kube-system/kube-dns:dns -> 10.244.0.2:53" -j KUBE-SEP-YIL6JZP7A3QYXJU2
+-A KUBE-SVC-VSAWDMSKNMGTSBJ2 ! -s 10.244.0.0/16 -d 10.96.36.140/32 -p tcp -m comment --comment "default/loadbalancer-svc cluster IP" -m tcp --dport 80 -j KUBE-MARK-MASQ
+-A KUBE-SVC-VSAWDMSKNMGTSBJ2 -m comment --comment "default/loadbalancer-svc -> 10.244.1.2:5000" -j KUBE-SEP-GR4AD662XYN6ALE6
 COMMIT
-# Completed on Tue May 20 13:02:14 2025
+# Completed on Tue May 20 13:04:30 2025
