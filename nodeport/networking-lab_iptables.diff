--- iptables/pre-apply/networking-lab/networking-lab_pre-apply.iptables	2025-05-20 13:50:27.523449033 +0100
+++ iptables/post-apply/networking-lab/networking-lab_post-apply.iptables	2025-05-20 13:52:48.075604799 +0100
@@ -1,4 +1,4 @@
-# Generated by iptables-save v1.8.10 (nf_tables) on Tue May 20 12:49:59 2025
+# Generated by iptables-save v1.8.10 (nf_tables) on Tue May 20 12:52:20 2025
 *mangle
 :PREROUTING ACCEPT [0:0]
 :INPUT ACCEPT [0:0]
@@ -9,8 +9,8 @@
 :KUBE-KUBELET-CANARY - [0:0]
 :KUBE-PROXY-CANARY - [0:0]
 COMMIT
-# Completed on Tue May 20 12:49:59 2025
-# Generated by iptables-save v1.8.10 (nf_tables) on Tue May 20 12:49:59 2025
+# Completed on Tue May 20 12:52:20 2025
+# Generated by iptables-save v1.8.10 (nf_tables) on Tue May 20 12:52:20 2025
 *filter
 :INPUT ACCEPT [0:0]
 :FORWARD ACCEPT [0:0]
@@ -54,28 +54,31 @@
 -A KUBE-FORWARD -m comment --comment "kubernetes forwarding rules" -m mark --mark 0x4000/0x4000 -j ACCEPT
 -A KUBE-FORWARD -m comment --comment "kubernetes forwarding conntrack rule" -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
 COMMIT
-# Completed on Tue May 20 12:49:59 2025
-# Generated by iptables-save v1.8.10 (nf_tables) on Tue May 20 12:49:59 2025
+# Completed on Tue May 20 12:52:20 2025
+# Generated by iptables-save v1.8.10 (nf_tables) on Tue May 20 12:52:20 2025
 *nat
-:PREROUTING ACCEPT [46:2773]
-:INPUT ACCEPT [49:2965]
-:OUTPUT ACCEPT [1104:66220]
-:POSTROUTING ACCEPT [1131:68470]
+:PREROUTING ACCEPT [51:3073]
+:INPUT ACCEPT [54:3265]
+:OUTPUT ACCEPT [1616:96940]
+:POSTROUTING ACCEPT [1643:99190]
 :DOCKER - [0:0]
 :DOCKER_OUTPUT - [0:0]
 :DOCKER_POSTROUTING - [0:0]
 :KIND-MASQ-AGENT - [0:0]
+:KUBE-EXT-FDIGUWRAAKMFZSYO - [0:0]
 :KUBE-KUBELET-CANARY - [0:0]
 :KUBE-MARK-MASQ - [0:0]
 :KUBE-NODEPORTS - [0:0]
 :KUBE-POSTROUTING - [0:0]
 :KUBE-PROXY-CANARY - [0:0]
 :KUBE-SEP-IT2ZTR26TO4XFPTO - [0:0]
+:KUBE-SEP-KWXCNY4QTEDU7A4W - [0:0]
 :KUBE-SEP-N4G2XR5TDX7PQE7P - [0:0]
 :KUBE-SEP-VPILYQBSPPXYB66K - [0:0]
 :KUBE-SEP-YIL6JZP7A3QYXJU2 - [0:0]
 :KUBE-SERVICES - [0:0]
 :KUBE-SVC-ERIFXISQEP7F7OF4 - [0:0]
+:KUBE-SVC-FDIGUWRAAKMFZSYO - [0:0]
 :KUBE-SVC-JD5MR3NA4I4DYORP - [0:0]
 :KUBE-SVC-NPX46M4PTMTKRN6Y - [0:0]
 :KUBE-SVC-TCOU7JCQXEZGVUNU - [0:0]
@@ -96,12 +99,18 @@
 -A DOCKER_POSTROUTING -s 127.0.0.11/32 -p udp -j SNAT --to-source 192.168.49.1:53
 -A KIND-MASQ-AGENT -d 10.244.0.0/16 -m comment --comment "kind-masq-agent: local traffic is not subject to MASQUERADE" -j RETURN
 -A KIND-MASQ-AGENT -m comment --comment "kind-masq-agent: outbound traffic is subject to MASQUERADE (must be last in chain)" -j MASQUERADE
+-A KUBE-EXT-FDIGUWRAAKMFZSYO -m comment --comment "masquerade traffic for default/nodeport-svc external destinations" -j KUBE-MARK-MASQ
+-A KUBE-EXT-FDIGUWRAAKMFZSYO -j KUBE-SVC-FDIGUWRAAKMFZSYO
 -A KUBE-MARK-MASQ -j MARK --set-xmark 0x4000/0x4000
+-A KUBE-NODEPORTS -d 127.0.0.0/8 -p tcp -m comment --comment "default/nodeport-svc" -m tcp --dport 30000 -m nfacct --nfacct-name  localhost_nps_accepted_pkts -j KUBE-EXT-FDIGUWRAAKMFZSYO
+-A KUBE-NODEPORTS -p tcp -m comment --comment "default/nodeport-svc" -m tcp --dport 30000 -j KUBE-EXT-FDIGUWRAAKMFZSYO
 -A KUBE-POSTROUTING -m mark ! --mark 0x4000/0x4000 -j RETURN
 -A KUBE-POSTROUTING -j MARK --set-xmark 0x4000/0x0
 -A KUBE-POSTROUTING -m comment --comment "kubernetes service traffic requiring SNAT" -j MASQUERADE --random-fully
 -A KUBE-SEP-IT2ZTR26TO4XFPTO -s 10.244.0.2/32 -m comment --comment "kube-system/kube-dns:dns-tcp" -j KUBE-MARK-MASQ
 -A KUBE-SEP-IT2ZTR26TO4XFPTO -p tcp -m comment --comment "kube-system/kube-dns:dns-tcp" -m tcp -j DNAT --to-destination 10.244.0.2:53
+-A KUBE-SEP-KWXCNY4QTEDU7A4W -s 10.244.1.2/32 -m comment --comment "default/nodeport-svc" -j KUBE-MARK-MASQ
+-A KUBE-SEP-KWXCNY4QTEDU7A4W -p tcp -m comment --comment "default/nodeport-svc" -m tcp -j DNAT --to-destination 10.244.1.2:5000
 -A KUBE-SEP-N4G2XR5TDX7PQE7P -s 10.244.0.2/32 -m comment --comment "kube-system/kube-dns:metrics" -j KUBE-MARK-MASQ
 -A KUBE-SEP-N4G2XR5TDX7PQE7P -p tcp -m comment --comment "kube-system/kube-dns:metrics" -m tcp -j DNAT --to-destination 10.244.0.2:9153
 -A KUBE-SEP-VPILYQBSPPXYB66K -s 192.168.49.2/32 -m comment --comment "default/kubernetes:https" -j KUBE-MARK-MASQ
@@ -112,9 +121,12 @@
 -A KUBE-SERVICES -d 10.96.0.10/32 -p tcp -m comment --comment "kube-system/kube-dns:metrics cluster IP" -m tcp --dport 9153 -j KUBE-SVC-JD5MR3NA4I4DYORP
 -A KUBE-SERVICES -d 10.96.0.10/32 -p udp -m comment --comment "kube-system/kube-dns:dns cluster IP" -m udp --dport 53 -j KUBE-SVC-TCOU7JCQXEZGVUNU
 -A KUBE-SERVICES -d 10.96.0.10/32 -p tcp -m comment --comment "kube-system/kube-dns:dns-tcp cluster IP" -m tcp --dport 53 -j KUBE-SVC-ERIFXISQEP7F7OF4
+-A KUBE-SERVICES -d 10.96.200.54/32 -p tcp -m comment --comment "default/nodeport-svc cluster IP" -m tcp --dport 80 -j KUBE-SVC-FDIGUWRAAKMFZSYO
 -A KUBE-SERVICES -m comment --comment "kubernetes service nodeports; NOTE: this must be the last rule in this chain" -m addrtype --dst-type LOCAL -j KUBE-NODEPORTS
 -A KUBE-SVC-ERIFXISQEP7F7OF4 ! -s 10.244.0.0/16 -d 10.96.0.10/32 -p tcp -m comment --comment "kube-system/kube-dns:dns-tcp cluster IP" -m tcp --dport 53 -j KUBE-MARK-MASQ
 -A KUBE-SVC-ERIFXISQEP7F7OF4 -m comment --comment "kube-system/kube-dns:dns-tcp -> 10.244.0.2:53" -j KUBE-SEP-IT2ZTR26TO4XFPTO
+-A KUBE-SVC-FDIGUWRAAKMFZSYO ! -s 10.244.0.0/16 -d 10.96.200.54/32 -p tcp -m comment --comment "default/nodeport-svc cluster IP" -m tcp --dport 80 -j KUBE-MARK-MASQ
+-A KUBE-SVC-FDIGUWRAAKMFZSYO -m comment --comment "default/nodeport-svc -> 10.244.1.2:5000" -j KUBE-SEP-KWXCNY4QTEDU7A4W
 -A KUBE-SVC-JD5MR3NA4I4DYORP ! -s 10.244.0.0/16 -d 10.96.0.10/32 -p tcp -m comment --comment "kube-system/kube-dns:metrics cluster IP" -m tcp --dport 9153 -j KUBE-MARK-MASQ
 -A KUBE-SVC-JD5MR3NA4I4DYORP -m comment --comment "kube-system/kube-dns:metrics -> 10.244.0.2:9153" -j KUBE-SEP-N4G2XR5TDX7PQE7P
 -A KUBE-SVC-NPX46M4PTMTKRN6Y ! -s 10.244.0.0/16 -d 10.96.0.1/32 -p tcp -m comment --comment "default/kubernetes:https cluster IP" -m tcp --dport 443 -j KUBE-MARK-MASQ
@@ -122,4 +134,4 @@
 -A KUBE-SVC-TCOU7JCQXEZGVUNU ! -s 10.244.0.0/16 -d 10.96.0.10/32 -p udp -m comment --comment "kube-system/kube-dns:dns cluster IP" -m udp --dport 53 -j KUBE-MARK-MASQ
 -A KUBE-SVC-TCOU7JCQXEZGVUNU -m comment --comment "kube-system/kube-dns:dns -> 10.244.0.2:53" -j KUBE-SEP-YIL6JZP7A3QYXJU2
 COMMIT
-# Completed on Tue May 20 12:49:59 2025
+# Completed on Tue May 20 12:52:20 2025
